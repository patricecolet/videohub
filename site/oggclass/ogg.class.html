<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html><head>
<meta http-equiv="content-type" content="text/html; charset=ISO-8859-1"><title>Ogg.class.php</title>

<style type="text/css">
body { width: 780px; margin: 0 auto; text-align: left; padding-top: 1.5em;}
.bloc1 {	border: solid 2px #cccccc; margin: 1em; padding: 1em; background-color: #eeeeff; }
.bloc1 hr { border: solid 1px #cccccc; }
.bloc2 {	border: solid 1px #000000; margin: 1em; padding: 0em; background-color: #ffffff; }
.bloc2 p { margin: 0px; padding-left: 1em; }
.code 			{ white-space: pre; line-height: 1; padding: 1em; background-color: #e1e1e1; margin: 10px; border: 1px outset #000; }
.code > span 	{ font-family: 'Courier New'; font-size: 8pt; color: #000000; }
.code > .sc0 	{ font-weight: bold; }
.code > .sc18 	{ color: #FF0000; }
.code > .sc118 	{  }
.code > .sc119 	{ color: #808080; }
.code > .sc120 	{ color: #808080; }
.code > .sc121 	{ font-weight: bold; color: #0000FF; }
.code > .sc123 	{ color: #000080; }
.code > .sc125 	{ font-family: 'Comic Sans MS';	font-size: 8pt;	color: #008000;	}
.code > .sc127 	{ color: #8000FF; }
.output  		{ font-family: 'Courier New'; font-size: 8pt; line-height: 1; padding: 1em; background-color: #e1e1e1; margin: 10px; border: 1px outset #000; }
</style>
</head>
<body>
<center><h1>Ogg.class.php v1.3g</h1>
<a href="http://opensource.grisambre.net/ogg">http://opensource.grisambre.net/ogg</a><br><br>[<a href="#examples">Examples</a>] [<a href="#reference">Class Reference</a>] [<a href="#download">Download</a>] [<a href="#history">History</a>] [<a href="#links">Links</a>]</center>
<br><br>
Ogg.class.php is a <a href="http://www.php.net/manual/en/language.oop.php">PHP class</a> for <a href="http://www.php.net/">PHP&gt;= 4</a> designed to offer on
the server-side a few basic fonctionnalities (currenly: only for <a href="http://www.vorbis.org/">Vorbis Audio</a> and <a href="http://www.theora.org/">Theora Video</a> streams encapsulated inside the <a href="http://xiph.org/ogg/">Ogg container</a>):<br>
<ul>
<li>Extract or calculate informations from the file (frame size,
duration, comments tags, frame rate, channels, sample rate...) including from <a href="http://wiki.xiph.org/index.php/Ogg_Skeleton">Ogg Skeleton</a> or <a href="http://annodex.net/TR/draft-pfeiffer-cmml-03.html">CMML</a> MetaData.</li>
<li>Extract a picture from the video (currently: only if module <a href="http://ffmpeg-php.sourceforge.net">ffmpeg-php</a> is installed on server)</li>
<li>Insert / change comment tags and vendor strings</li>
</ul>
Altogether, for an example, with <a href="http://menguy.aymeric.free.fr/theora/">Itheora</a>, it allows to broadcast easily
audio or video on your web site.<br>
Ogg.class.php is free and "open source", and is licensed under the <a href="http://www.gnu.org/licenses/gpl.html">GNU GPL 3</a> - copyleft Nicolas Ricquemaque 2008 [contact: opensource (arobase) grisambre dot net].<br>
<h3><a name="examples">Quick examples</h3>
<div class="bloc1">
A few quick examples is the best way to show how it works ! However, only minimal error detection is made here. For a more comprehensive example, just have a look into the <b>demo.php</b> included with the library archive.<br><br>
<b>Example(1): Reading information from an OGG file</b><br><br>
<div class="bloc2">
<p><b>Code:</b></p>
<div class="code"><span class="sc18">&lt;?php</span><span class="sc118">
</span><span class="sc121">require_once</span><span class="sc127">(</span><span class="sc119">"ogg.class.php"</span><span class="sc127">);</span>
<span class="sc123">$video</span><span class="sc127">=</span><span class="sc121">new</span><span class="sc118"> Ogg </span><span class="sc127">(</span><span class="sc119">"myfile.ogv"</span><span class="sc127">);</span>
<span class="sc121">if </span><span class="sc127">(</span><span class="sc123">$video</span><span class="sc127">-&gt;</span><span class="sc118">LastError</span><span class="sc127">)</span><span class="sc127"> { </span><span class="sc121">echo</span><span class="sc123"> $video</span><span class="sc127">-&gt;</span><span class="sc118">LastError</span><span class="sc127">; </span><span class="sc121">exit</span><span class="sc127">; </span><span class="sc127">}</span>
<span class="sc121">print_r</span><span class="sc127">(</span><span class="sc123">$video</span><span class="sc127">-&gt;</span><span class="sc118">Streams</span><span class="sc127">);</span><span class="sc118">
</span><span class="sc18">?&gt;</span><span class="sc0"></div>
<br>
<p><b>Result: (values <span style="color: blue;">from header</span> - <span style="color: red;">Computed value</span> - <span style="color: rgb(102, 51, 102);">For internal use</span>)</b></p>
<div class="output">
Array<br>(<br>[<i>oggfile</i>]&nbsp;=&gt;&nbsp;myfile.ogv<br>[<i>cachefile</i>]&nbsp;=&gt;&nbsp;myfile.ogv.cache<br>[<i>size</i>]&nbsp;=&gt;&nbsp;1250920<br>[<i>source</i>]&nbsp;=&gt;&nbsp;file<br>[<i>picturable</i>]&nbsp;=&gt;&nbsp;1<br>[<i>encoding</i>]&nbsp;=&gt;&nbsp;ansi<br>[<i>summary</i>]&nbsp;=&gt;&nbsp;<span style="color: red;"> myfile.ogv (1221 kB)<br>Video (theora): 16s 320x240 29.97fps Q=32<br>ENCODER=ffmpeg2theora 0.20<br><br>Audio (Vorbis 30kb/s): 16s mono 22kB/s<br>ENCODER=ffmpeg2theora 0.20</span><br><br>[<i>theora</i>]&nbsp;=&gt;&nbsp;Array ( <span style="color: blue;">[<i>serial</i>]&nbsp;=&gt;&nbsp;19370 [<i>vmaj</i>]&nbsp;=&gt;&nbsp;3 [<i>vmin</i>]&nbsp;=&gt;&nbsp;2 [<i>vrev</i>]&nbsp;=&gt;&nbsp;1 [<i>fmbw</i>]&nbsp;=&gt;&nbsp;20 [<i>fmbh</i>]&nbsp;=&gt;&nbsp;15 [<i>picw</i>]&nbsp;=&gt;&nbsp;320 [<i>pich</i>]&nbsp;=&gt;&nbsp;240 [<i>picx</i>] =&gt;0 [<i>picy</i>]&nbsp;=&gt;&nbsp;0</span> <span style="color: red;">[<i>width</i>]&nbsp;=&gt;&nbsp;320 [<i>height</i>]&nbsp;=&gt;&nbsp;240</span> <span style="color: blue;">[<i>frn</i>]&nbsp;=&gt;&nbsp;30000 [<i>frd</i>]&nbsp;=&gt;&nbsp;1001</span> <span style="color: red;">[<i>frate</i>]&nbsp;=&gt;&nbsp;29.97</span> <span style="color: blue;">[<i>parn</i>]&nbsp;=&gt;&nbsp;1 [<i>pard</i>]&nbsp;=&gt;&nbsp;1 [<i>cs</i>]&nbsp;=&gt;&nbsp;1 [<i>nombr</i>]&nbsp;=&gt;&nbsp;0 [<i>qual</i>]&nbsp;=&gt;&nbsp;32 [<i>kfgshift</i>]&nbsp;=&gt;&nbsp;6 [<i>pf</i>]&nbsp;=&gt;&nbsp;0 [<i>vendor</i>]&nbsp;=&gt;&nbsp;Xiph.Org libTheora I 20071025 3 2 1 [<i>comments</i>]&nbsp;=&gt;&nbsp;Array ( [<i>0</i>]&nbsp;=&gt;&nbsp;ENCODER=ffmpeg2theora 0.20 )</span>&nbsp;<span style="color: rgb(102, 51, 102);">[<i>commentlen</i>]&nbsp;=&gt;&nbsp;99 [<i>commentpos</i>]&nbsp;=&gt;&nbsp;128 [<i>commentnext</i>]&nbsp;=&gt;&nbsp;2879 [<i>commentleftSegments</i>]&nbsp;=&gt;&nbsp;ÿÿÿÿÿÿÿÿÿÿ?</span> <span style="color: red;">[<i>framecount</i>]&nbsp;=&gt;&nbsp;584</span> <span style="color: red;">[<i>duration</i>]&nbsp;=&gt;&nbsp;16</span> )<br><br>[<i>vorbis</i>]&nbsp;=&gt;&nbsp;Array (<span style="color: blue;"> [<i>serial</i>]&nbsp;=&gt;&nbsp;141 [<i>channels</i>]&nbsp;=&gt;&nbsp;1 [<i>samplerate</i>]&nbsp;=&gt;&nbsp;22050 [<i>maxbitrate</i>]&nbsp;=&gt;&nbsp;0 [<i>nombitrate</i>]&nbsp;=&gt;&nbsp;30444 [<i>minbitrate</i>]&nbsp;=&gt;&nbsp;0 <span style="color: red;">[<i>bitrate</i>]=&gt; 30444</span> [<i>vendor</i>]&nbsp;=&gt;&nbsp;AO; aoTuV b5 [<i>20061024</i>] (based on Xiph.Org's libVorbis) [<i>comments</i>]&nbsp;=&gt;&nbsp;Array ( [<i>0</i>]&nbsp;=&gt;&nbsp;ENCODER=ffmpeg2theora 0.20 )</span> <span style="color: rgb(102, 51, 102);">[<i>commentlen</i>]&nbsp;=&gt;&nbsp;120 [<i>commentpos</i>]&nbsp;=&gt;&nbsp;2879 [<i>commentnext</i>]&nbsp;=&gt;&nbsp;6297 [<i>commentleftSegments</i>]&nbsp;=&gt;&nbsp;ÿÿÿÿÿÿÿÿÿÿÿÿÅ</span> <span style="color: red;">[<i>duration</i>]&nbsp;=&gt;&nbsp;16</span><br><br>
<span style="color: red;">[<i>duration</i>]&nbsp;=&gt;&nbsp;16</span><br>)
</div></div>
<br>
<b>Example(2): Adding a comment to the same Ogg file to both vorbis and theora streams if they exist</b><br><br>
<div class="bloc2">
<p><b>Code:</b></p>
<div class="code"><span class="sc18">&lt;?php</span>
<span class="sc121">require_once</span><span class="sc127">(</span><span class="sc119">"ogg.class.php"</span><span class="sc127">);</span><span class="sc118">
</span><span class="sc123">$video</span><span class="sc127">=</span><span class="sc121">new</span><span class="sc118"> Ogg </span><span class="sc127">(</span><span class="sc119">"myfile.ogv"</span><span class="sc127">);</span>
<span class="sc121">if </span><span class="sc127">(</span><span class="sc123">$video</span><span class="sc127">-&gt;</span><span class="sc118">LastError</span><span class="sc127">)</span><span class="sc127"> { </span><span class="sc121">echo</span><span class="sc123"> $video</span><span class="sc127">-&gt;</span><span class="sc118">LastError</span><span class="sc127">; </span><span class="sc121">exit</span><span class="sc127">; </span><span class="sc127">}</span>
<span class="sc125">// Does this file have a vorbis stream ?</span><span class="sc118">
</span><span class="sc121">if </span><span class="sc127">(</span><span class="sc121">isset</span><span class="sc127">(</span><span class="sc123">$video</span><span class="sc127">-&gt;</span><span class="sc118">Streams</span><span class="sc127">[</span><span class="sc120">'vorbis'</span><span class="sc127">]))</span><span class="sc118"> 
    </span><span class="sc123">$video</span><span class="sc127">-&gt;</span><span class="sc118">Streams</span><span class="sc127">[</span><span class="sc120">'vorbis'</span><span class="sc127">][</span><span class="sc120">'comments'</span><span class="sc127">][]=</span><span class="sc119">"ARTIST=Nicolas"</span><span class="sc127">;</span><span class="sc118">
</span><span class="sc125">// Does this file have a theora stream ?</span><span class="sc118">
</span><span class="sc121">if </span><span class="sc127">(</span><span class="sc121">isset</span><span class="sc127">(</span><span class="sc123">$video</span><span class="sc127">-&gt;</span><span class="sc118">Streams</span><span class="sc127">[</span><span class="sc120">'theora'</span><span class="sc127">]))</span><span class="sc118"> 
    </span><span class="sc123">$video</span><span class="sc127">-&gt;</span><span class="sc118">Streams</span><span class="sc127">[</span><span class="sc120">'vorbis'</span><span class="sc127">][</span><span class="sc120">'comments'</span><span class="sc127">][]=</span><span class="sc119">"ARTIST=Nicolas"</span><span class="sc127">;</span><span class="sc118">
</span><span class="sc123">$video</span><span class="sc127">-&gt;</span><span class="sc118">WriteNewComments</span><span class="sc127">();</span><span class="sc118">
print_r</span><span class="sc127">(</span><span class="sc123">$video</span><span class="sc127">-&gt;</span><span class="sc118">Streams</span><span class="sc127">);</span><span class="sc118">
</span><span class="sc18">?&gt;</span><span class="sc0">
</span></div>
<br>
<p><b>Result: (values <span style="color: blue;">from header</span> - <span style="color: red;">Computed value</span> - <span style="color: rgb(102, 51, 102);">For internal use</span>)</b></p>
<div class="output">
Array<br>(<br>[<i>oggfile</i>]&nbsp;=&gt;&nbsp;myfile.ogv<br>[<i>cachefile</i>]&nbsp;=&gt;&nbsp;myfile.ogv.cache<br>[<i>size</i>]&nbsp;=&gt;&nbsp;1250920<br>[<i>source</i>]&nbsp;=&gt;&nbsp;file<br>[<i>picturable</i>]&nbsp;=&gt;&nbsp;1<br>[<i>encoding</i>]&nbsp;=&gt;&nbsp;ansi<br>[<i>summary</i>]&nbsp;=&gt;&nbsp;<span style="color: red;"> myfile.ogv (1221 kB)<br>Video (theora): 16s 320x240 29.97fps Q=32<br>ENCODER=ffmpeg2theora 0.20<br><br>Audio (Vorbis 30kb/s): 16s mono 22kB/s<br>ENCODER=ffmpeg2theora 0.20</span><br><br>[<i>theora</i>]&nbsp;=&gt;&nbsp;Array ( <span style="color: blue;">[<i>serial</i>]&nbsp;=&gt;&nbsp;19370 [<i>vmaj</i>]&nbsp;=&gt;&nbsp;3 [<i>vmin</i>]&nbsp;=&gt;&nbsp;2 [<i>vrev</i>]&nbsp;=&gt;&nbsp;1 [<i>fmbw</i>]&nbsp;=&gt;&nbsp;20 [<i>fmbh</i>]&nbsp;=&gt;&nbsp;15 [<i>picw</i>]&nbsp;=&gt;&nbsp;320 [<i>pich</i>]&nbsp;=&gt;&nbsp;240 [<i>picx</i>] =&gt;0 [<i>picy</i>]&nbsp;=&gt;&nbsp;0</span> <span style="color: red;">[<i>width</i>]&nbsp;=&gt;&nbsp;320 [<i>height</i>]&nbsp;=&gt;&nbsp;240</span> <span style="color: blue;">[<i>frn</i>]&nbsp;=&gt;&nbsp;30000 [<i>frd</i>]&nbsp;=&gt;&nbsp;1001</span> <span style="color: red;">[<i>frate</i>]&nbsp;=&gt;&nbsp;29.97</span> <span style="color: blue;">[<i>parn</i>]&nbsp;=&gt;&nbsp;1 [<i>pard</i>]&nbsp;=&gt;&nbsp;1 [<i>cs</i>]&nbsp;=&gt;&nbsp;1 [<i>nombr</i>]&nbsp;=&gt;&nbsp;0 [<i>qual</i>]&nbsp;=&gt;&nbsp;32 [<i>kfgshift</i>]&nbsp;=&gt;&nbsp;6 [<i>pf</i>]&nbsp;=&gt;&nbsp;0 [<i>vendor</i>]&nbsp;=&gt;&nbsp;Xiph.Org libTheora I 20071025 3 2 1 [<i>Ogg.class.php v1</i>] [<i>comments</i>]&nbsp;=&gt;&nbsp;Array ( [<i>0</i>]&nbsp;=&gt;&nbsp;ENCODER=ffmpeg2theora 0.20 <b>[<i>1</i>]&nbsp;=&gt;&nbsp;ARTIST=Nicolas</b> )</span>&nbsp;<span style="color: rgb(102, 51, 102);">[<i>commentlen</i>]&nbsp;=&gt;&nbsp;99 [<i>commentpos</i>]&nbsp;=&gt;&nbsp;128 [<i>commentnext</i>]&nbsp;=&gt;&nbsp;2879 [<i>commentleftSegments</i>]&nbsp;=&gt;&nbsp;ÿÿÿÿÿÿÿÿÿÿ?</span> <span style="color: red;">[<i>framecount</i>]&nbsp;=&gt;&nbsp;584</span> <span style="color: red;">[<i>duration</i>]&nbsp;=&gt;&nbsp;16</span> )<br><br>[<i>vorbis</i>]&nbsp;=&gt;&nbsp;Array (<span style="color: blue;"> [<i>serial</i>]&nbsp;=&gt;&nbsp;141 [<i>channels</i>]&nbsp;=&gt;&nbsp;1 [<i>samplerate</i>]&nbsp;=&gt;&nbsp;22050 [<i>maxbitrate</i>]&nbsp;=&gt;&nbsp;0 [<i>nombitrate</i>]&nbsp;=&gt;&nbsp;30444 [<i>minbitrate</i>]&nbsp;=&gt;&nbsp;0 <span style="color: red;">[<i>bitrate</i>]=&gt; 30444</span> [<i>vendor</i>]&nbsp;=&gt;&nbsp;AO; aoTuV b5 [<i>20061024</i>] (based on Xiph.Org's libVorbis) [<i>Ogg.class.php v1</i>] [<i>comments</i>]&nbsp;=&gt;&nbsp;Array ( [<i>0</i>]&nbsp;=&gt;&nbsp;ENCODER=ffmpeg2theora 0.20 <b>[<i>1</i>]&nbsp;=&gt;&nbsp;ARTIST=Nicolas</b> )</span> <span style="color: rgb(102, 51, 102);">[<i>commentlen</i>]&nbsp;=&gt;&nbsp;120 [<i>commentpos</i>]&nbsp;=&gt;&nbsp;2879 [<i>commentnext</i>]&nbsp;=&gt;&nbsp;6297 [<i>commentleftSegments</i>]&nbsp;=&gt;&nbsp;ÿÿÿÿÿÿÿÿÿÿÿÿÅ</span> <span style="color: red;">[<i>duration</i>]&nbsp;=&gt;&nbsp;16</span> )<br><br>
<span style="color: red;">[<i>duration</i>]&nbsp;=&gt;&nbsp;16</span><br>)
</div></div></div>
<br>
<h3><a name="reference">Class reference</h3>
<div class="bloc1">
<u>Constructor:</u> <b><i>object</i> Ogg (<i>string</i> $file[, <i>integer</i> $options=ANSI+CACHING [, <i>string</i> $cachedir="/cache.ogg"]])</b><br>
<ul><li>$file must be provided with full location. for an example: "/IMG/ogg/myfile.ogv". $file can be a relative path (no '/' at the beginning), an absolute path to the server document root (with a beginnin '/'), an absolute path to the server file system root, but within your public folders, or a remote http:// location. For instance, the class can only retrieve information from a remote (http://) ogg file if your server allows either the fsockopen() or fopen(http) calls in their configuration.</li>
<li>$options is an optional parameter consisting a sum of the following constants: (CACHING or NOCACHING) + (ANSI or UTF8) + NOVENDORTAG + UPDATECACHE, with a default value of <u>ANSI</u> + <u>CACHING</u>.</li>
<li>$cachedir is an optional parameter to define the absolute path where, from the root folder, the cache information should be stored (if enabled). The default is "/cache.ogg"</li></ul>

UTF8 or ANSI, defines the strings encoding of the extracted ogg information (for instance: comments, vendor, summary). Please note that this does NOT affect the way new comments will eventualy be written to the file later, which will automaticaly be converted (if necessary) to UTF8 by format standard.<br>
<br>
CACHING or NOCACHING allows or disables caching the information of the file. Enabling will improve dramaticaly performances. Basicaly, the first time the constructor is parsing a file "/IMG/ogg/myfile.ogv", it will create a file "/<i>$cachedir</i>/myfile.ogv.cache", that can be reused the next time. When a file is parsed, about 128kb of the file (64kb at the begnning and 64kb at the end) must be analysed to extract information.<br>
<br>
UPDATECACHE (only if CACHING is enabled) is forcing the cache file to be overwritten (if existing) with up-to-date information fresh from the file. Warning: any previously user added information using the CacheUpdate() function will be lost.<br>
<br>
NOVENDORTAG disables the automatic tagging of the vendor field with the version of this class, for reference or future debugging.<br>
<br>
After the creation of the Ogg object or after any call of a public method of this class, it is strongly advised to check the public variable LastError. If LastError is <i>false</i> everything is fine; else, LastError will contain a <i>string</i> describing the problem.<br>
<br>
If no problem occured, the public variable <u>Streams</u> will be an <i>array</i> with all king of information the library was able to retrieve, as shown in the previous example. The subarrays ['theora'] and ['vorbis'] will only be set if such stream was detected in the ogg file; therefore, checking for their presence will allow the user to see if the file is audio/video or only audio or only video.<br>
<br><hr><br>
<u>Public method:</u> <b><i>integer</i> WriteNewComments ([<i>integer</i> $refresh=5])</b><br>
$refresh is an optional value in seconds after which the function will return (even if the writting is not complete). The interest of not writting the file is dual; in fact, the writting can take verrrrryyyyyy long, is the file is BIG. It is common to see video files with a size over 100++ MB. Unfortunately, it is not possibe with Ogg files just to "change" the comments in the middle of the file wihtin one shot : the whole file must be rewritten every time, taking a variable time. So splitting it in several calls in as many sessions will allow:
<ul>
<li>Not to break the script php timeout "max_execution_time" (you can get it with a call to get_cfg_var("max_execution_time") or check your php.ini parameters file).</li>
<li>to advise the front end user of the writting progress (most of the time, if nothing occurs after 10 seconds, the user might interrupt the process thinking something has failed).</li>
</ul>
So calling this function Will <b>begin</b> to re-write the file with the comments you would have previously updated in the public array "<u>Streams</u>" described below.<br>
<br>
<i>Return value:</i> false if a problem occured (then check the LastError string to understand what went wrong) or the position in the file where the fonction ended. If the this value equals Streams['size'], then the file is complete (and the cache has been updated). Else, the calling script will have to call the other function "ContinueWrite()" (see below) in another session to continue the writting...<br>
<br><hr><br>
<u>Public method:</u> <b><i>integer</i> ContinueWrite ()</b><br>
As explain before, this conction must be called as many times as necessary to complete the writting of the file started with the function "WriteNewComments()" previously described.<br>
<br>
<i>Return value:</i> false if a problem occured (then check the LastError string to understand what went wrong) or the position in the file where the fonction ended. If the this value equals Streams['size'], then the file is complete (and the cache has been updated). Else, the calling script will have to call the same function again in another session to continue the writting...<br>
<br><hr><br>
<u>Public method:</u> <b><i>string</i> GetPicture ([<i>int</i> $framepos=1, [<i>string</i> $where=false]])</b><br>
This functions extracts a jpeg picture from the frame '$framepos' of the video. if $framepos is omitted, the first frame of the video is extracted. The second parameter allows to specify where the picture will be stored; if omitted, this will store the picture in the cache folder with a name like 'myvideo.ogv.f1.jpg' (f1 designating the frame number). For future use, each extracted picture will be shown in the Streams[theora][pictures] array (see below). Before calling this function, user should check if the variable Streams[picturable] is true.<br>
<br>
<i>Return value:</i> false if a problem occured (then check the LastError string to understand what went wrong) or the picture location.<br>
<br><hr><br>
<u>Public method:</u> <b><i>bool</i> CacheUpdate ()</b><br>
It may be useful for the user to add his own fields to the Streams array and save it in cache for future use. This function simply allows to update the cache file with whatever the user added/modified in the <i>Streams</i> array.<br>
<b>Warning !</b> If you change existing values, it will not really update the Ogg file, just the information displayed. Furthermore, Changing existing values like [commentlen] and [commentpos] could permanently damage the Ogg file if trying later to rewrite the comment tags !<br>
<br>
<i>Return value:</i> false if a problem occured (then check the LastError string to understand what went wrong) or true and the cache file is updated.<br>
<br><hr><br>
<u>Public variable:</u> <b><i>bool/string</i> LastError</b><br>
Contains either <i>false</i> if no error recently occured, or a <i>string</i> explaining the error in full text and in english.<br>
<br><hr><br>
<u>Public variable:</u> <b><i>array</i> Streams</b><br>
This is the location where the class is storing whatever information it was able to get from the ogg file. While some parameters may be very useful from the calling application or the user, some are very technical and will most likely not be used. Anyway, all the information is here, and the variables have the same name as in the xiph.org documentation, and the same meaning. The most important variables will be described below, but don't hesitate to make a "print_r(<i>$this_array</i>);" call to php to get an exhaustive list. However, some parameters will only appear in the array if they have a meaning for this file. For an example, you won't find vorbis related information if this is a pure video file ! 
<ul>
<li>[oggfile] : Name and location of the ogg file given in parameter to the constructor</li>
<li>[cachefile] : Name and location of the cache file associated, if caching is enabled</li>
<li>[size] : File length in bytes</li>
<li>[source] : either 'cache' or 'file' to mean from where the information was extracted</li>
<li>[encoding] : either 'utf-8' or 'ansi' to describe encoding of the strings of this array, as requested in the constructor</li>
<li>[summary] : An human readable summary information about the ogg file</li>
<li>[duration] : Global duration of the ogg file. This is calculated as the biggest duration from the included streams</li>
<li>[tmpfile] : Name and location of a temporary file written recently by a <i>WriteNewComments()</i> call. Basicaly, if this variable is present, it means that the rewritting of this Ogg file is in progress and should be continued using a call to the function <i>ContinueWrite()</i></li>
<li>[tmpfileptr] : Where the writting of the previous file stopped. By comparing this value to [size], we can estimate the percentage of the file that was already completed</li>
<li>[picturable] : bool meaning is the script/server is able to extract a picture from this Ogg file.</li>
<li>[skeleton] : The presence of this sub-array means that an <a href="http://wiki.xiph.org/index.php/Ogg_Skeleton">Ogg Skeleton stream</a> was found if this Ogg file. Below the list of variables of this sub-array:
<ul>
<li>[version] : string in the form "major.minor" showing the Ogg Skeleton metadata version included in this file.</li>
<li>[utc] : if available, 20 Byte string containing a UTC time in the form of "YYYYMMDDTHHMMSS.sssZ"</li>
</ul>
<li>[cmml] : The presence of this sub-array means that some CMML Metadata was found if this Ogg file. Below the list of variables of this sub-array:
<ul>
<li>[version] : string in the form "major.minor" showing the Ogg <a href="http://annodex.net/TR/draft-pfeiffer-cmml-03.html">CMML</a> version included in this file.</li>
<li>[serial] : Technical parameter to identify this stream amoung others</li>
<li>[text] : CMML text string with the CMML Metadata content that was extracted</li>
</ul>
<li>[vorbis] : The presence of this sub-array means that a Vorbis stream was found if this Ogg file. Actually, if several vorbis streams would be present in a file (for an exemple: one for each supported language), only the first one will be analysed. Below the list of variables of this sub-array:
<ul>
<li>[serial] : Technical parameter to identify this stream amoung others</li>
<li>[channels] : Number of audio channels in this stream. For an example, '2' for a stereo stream</li>
<li>[samplerate] : Sample rate in bytes per second</li>
<li>[maxbitrate] : Maximal bitrate for a VBR encoding</li>
<li>[nombitrate] : Nominal bitrate for a CBR encoding</li>
<li>[minbitrate] : Minimal bitrate for a VBR encoding</li>
<li>[bitrate] : Best calculated bitrate from previous values</li>
<li>[vendor] : Vendor string (you might alter this value before eventualy re-writting the file)</li>
<li>[comments] : array of as many entries as you have comments in this file (can be empty; you shallt alter theses values before eventualy re-writting the file)</li>
<li>[commentlen], [commentpos], [commentnext], [commentleftSegments] : Technical values to allow eventualy rewritting the file. Those values should never be edited, or then the produced file will not be readable any more !</li>
<li>[skeleton] : if some Ogg Skeleton information is available describing this stream, you will find here a string containing the "Message header fields" according to <a href="http://www.ietf.org/rfc/rfc2822.txt">Rfc1822</a>.</li>
<li>[duration] :  calculated duration (in seconds) of the stream</li>
</ul>
<li>[theora] : The presence of this sub-array means that a Theora stream was found if this Ogg file. Actually, if several Theora streams would be present in a file, only the first one will be analysed. Below the list of variables of this sub-array:
<ul>
<li>[serial] : Technical parameter to identify this stream amoung others</li>
<li>[vmaj], [vmin], [vrev] : Major, minor, revision version of the theora format</li>
<li>[width], [height] : caculated image size in pixels</li>
<li>[frate] : frame rate in frames per seconds, rounded at 0.01s</li>
<li>[nombr] : Nominal bitrate</li>
<li>[qual] : Quality</li>
<li>[fmbw], [fmbh], [picw], [pich], [picx], [picy], [frn], [frd], [parn], [pard], [kfgshift], [pf], [cs] : Technical values. Check xiph.org documentation for more information</li>
<li>[pixelaspectratio],[colorspace],[pixelformat] : pixel encoding information</li>
<li>[vendor] : Vendor string (you might alter this value before eventualy re-writting the file)</li>
<li>[comments] : array of as many entries as you have comments in this file (can be empty; you shallt alter theses values before eventualy re-writting the file)</li>
<li>[commentlen], [commentpos], [commentnext], [commentleftSegments] : Technical values to allow eventualy rewritting the file. Those values should never be edited, or then the produced file will not be readable any more !</li>
<li>[skeleton] : if some Ogg Skeleton information is available describing this stream, you will find here a string containing the "Message header fields" according to <a href="http://www.ietf.org/rfc/rfc2822.txt">Rfc1822</a>.</li>
<li>[duration] :  calculated duration (in seconds) of the stream</li>
<li>[framecount] : Number of frames in the video</li>
<li>[pictures] : array of already extracted pictures available in cache. The array key is the frame number.</li>
</ul>
</ul>
</div>
<br>
<h3><a name="download">Download</h3>
<div class="bloc1">
<b>Contents : </b>
<ul>
<li><i>ogg.class.php.html</i> : This quick documentation</li>
<li><i>ogg.class.php</i> : The Ogg php class itself !</li>
<li><i>demo.php</i> : A demonstration file for trying the ogg php class. Please note that for security reasons, before using this file, you will need to fill up the $password variable string at the beginning of the file (no default value).</li>
<li><i>licence</i> : The GNU GPL 3 licence text</li>
</ul>
<b>Actual version (1.3g):</b> <a href="http://opensource.grisambre.net/ogg/ogg.class.zip">ogg.class.zip</a><br><br>
</div><br>
<h3><a name="history">History</h3>
<div class="bloc1">
<b>v1.0</b> (August 2007)<br>
First release, based mostly on the File_OGG pear package <a href="http://pear.php.net/package/File_Ogg">http://pear.php.net/package/File_Ogg</a> by David Grant. Added basic Theora support and caching, but kept same structure. This file was included with <a href="http://menguy.aymeric.free.fr/theora/">Itheora</a> v0.9 and later.
<hr>
<b>v1.1</b><br>
Still based on the File_Ogg pear library, but with big structural changes and improved theora support.
<hr>
<b>v1.2</b><br>
Intermediate version, to rewrite entirely the class, with first comment tags rewrite function, first ability to calculate Theora stream duration. This version was never published.
<hr>
<b>v1.3</b> (May 2008)<br>
Complete rewritting of the class for performance improvement; now, only 64kb at the beggining and 64kB at the end is sufficient to get all the data. Added support to analyse remote http files (if server supports it). Separation from the Itheora project (which is still using it), <a href="http://opensource.grisambre.net/ogg">new own website and first official documentation.</a>
<hr>
<b>v1.3e</b> (June 2008)<br>
Added picture extraction if php modules ffmpeg and gd2 are available.<br>
Added CacheUpdate() fonction for user to add his own data to the Streams array and save it inside cache.<br>
Added basic Ogg Skeleton and CMML MetaData handling capability
<hr>
<b>v1.3f</b> (September 2008)<br>
Corrected a bug for picture size not always accurate.<br>
Corrected a bug for calculating duration with files written as streaming (with <i>VLC</i>, for an example)<br>
Corrected a bug with the picture extraction when caching is disabled or cache was lost and picture is already existing<br>
Added the option UPDATECACHE to force analysing the file again and rewrite the cache file.<br>
Note: If you use also the cortado java applet, you better use the wikimedia forked version, with cmml-skeleton support and less bugs, as it looks like fluemotion has given up since 2006 on developping and updating their applet. See links below.
<hr>
<b>v1.3g</b> (November 2008)<br>
Corrected a bug in cache handling
</div><br>
<h3><a name="links">Links</h3>
<div class="bloc1">
<ul>
<li><a href="http://pear.php.net/package/File_Ogg">File_OGG pear package by David Grant</a></li>
<li><a href="http://menguy.aymeric.free.fr/theora/">Itheora Ogg (vorbis/theora) HTML player by Aymeric Menguy</a></li>
<li><a href="http://www.xiph.org/ogg/">Ogg container by xiph.org</a></li>
<li><a href="http://www.vorbis.org">Vorbis audio codec specifications by xiph.org</a></li>
<li><a href="http://www.theora.org">Theora Video codec specifications by xiph.org</a></li>
<li><a href="http://notepad-plus.sourceforge.net/">Notepad++ the best and open source code source editor for windows !</a></li>
<li><a href="http://www.flumotion.net/cortado/">Cortado, a java Ogg (Vorbis/Theora) applet</a></li>
<li><a href="http://svn.wikimedia.org/viewvc/mediawiki/trunk/cortado/"> The Wikimedia fork source SVN for the cortado applet: less bugs and skeleton support !</a></li>
<li><a href="http://upload.wikimedia.org/jars/cortado.jar">The wikimedia cortado applet (compiled)</a></li>
<li><a href="http://ffmpeg-php.sourceforge.net">ffmpeg php module (extension)</a></li>
<li><a href="http://wiki.xiph.org/index.php/Ogg_Skeleton">Ogg Skeleton MetaData stream specifications</a></li>
<li><a href="http://annodex.net/TR/draft-pfeiffer-cmml-03.html">CMML MetaData stream specifications</a></li>
<li><a href="http://v2v.cc/~j/theora_testsuite/">Some samples to test your theora decoder</a></li>
</ul>
</div>
<br>
</body></html>